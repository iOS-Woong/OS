# 프로세스의 상태 및 계층구조 (keyword: 프로세스 상태, 부모 프로세스, 자식 프로세스, 프로세스 계층 구조)

## 들어가기 앞서..
[스크린샷: 프로세스 상태 윈도우 작업관리자창]
- 어떤 프로세스는 실행중, 어떤 프로세스는 일시 중단됨 등 프로세스 상태가 PCB에 기록되며, 
    운영체제는 이를 기반정보로 수많은 프로세스들을 계층적으로 관리함.

### 프로세스 상태
- 하나의 프로세스는 여러 상태를 거치며 실행하게 된다.
- 그리고, 운영체제는 프로세스의 상태를 PCB를 통해 인식하고 관리함.

#### 생성상태
- 프로세스를 생성 중인 상태를 `생성상태(new)`라고 함.
- 이제 막 메모리에 적재되어 PCB를 할당받은 상태를 말함.
- 생성상태 이후, 실행 준비가 완료된 프로세스는 곧바로 실행되지 않고 준비 상태가 되어 CPU의 할당을 기다리게 됨.

#### 준비상태
- `준비상태(ready)`는 당장이라도 CPU를 할당받아 실행할 수 있지만, 아직 내 차례가 아니기에 기다리는 상태임.
- 준비상태 프로세스는 차례가 되면 CPU를 할당받아 실행 상태가 됨.

#### 실행상태
- `실행상태(running)`는 CPU를 할당 받아 실행중인 상태를 말함.
- 실행 상태인 프로세스는 할당된 일정 시간동안만 CPU를 사용할 수 있음
- 이 때, 프로세스가 할당된 시간을 모두 사용한다면(타이머 인터럽트가 발생하면) 다시 준비상태가 되고, 
    실행 도중 입출력장치를 사용하여 입출력 장치의 작업이 끝날 때까지 기다려야 한다면 대기 상태가 됨.

#### 대기상태
- 프로세스는 실행 도중 입출력장치를 사용하는 경우가 있음.
- 입출력 작업은 CPU에 비해 처리 속도가 느리기에 입출력 작업을 요청한 프로세스는 입출력장치가 입출력을 끝낼 때까지(입출력 완료 인터럽트를 받을 때 까지) 기다려야 함.
- `대기상태(blocked)`는 입출력장치의 작업을 기다리는 상태를 말하며, 입출력 작업이 완료되면 해당 프로세스는 다시 준비 상태로 CPU 할당을 기다리게 된다.

#### 종료상태
- `종료상태(terminated)`는 프로세스가 종료된 상태임. 
- 프로세스가 종료되면 운영체제는 PCB와 프로세스가 사용한 메모리를 정리함. 

[스크린샷:프로세스 상태 다이어그램]

- 프로세스는 생성, 준비, 실행, 대기, 종료 상태를 거치며 실행된다. 운영체제는 이 상태를 PCB에 기록하며 프로세스들을 관리하게 된다.

### 프로세스 계층 구조
- 프로세스는 실행 도중 시스템호출(시스템콜)을 통해 다른 프로세스를 생성 할 수 있음.
- 이때, 새 프로세스를 생성한 프로세스를 `부모 프로세스(parent process)` 라고 하며, 
    부모 프로세스에 의해 생성된 프로세스를 `자식 프로세스(child process)`라고 한다.
 - (부모 프로세스와 != 자식 프로세스) 이므로 각기 다른 PID를 가지게됨. (일부 운영체제에선 자식 프로세스의 PCB에 부모 프로세스의 PID가 기록되기도 함.)
 - 부모프로세스, 자식프로세스가 반복되는 이 과정을 도표로 나타내면 `프로세스 계층 구조`가 된다.
 
 [스크린샷: 프로세스 계층구조]
 
 예시: 
 - 사용자가 컴퓨터를 켜고, 로그인 창을 통해 성공적으로 로그인해서 bash 셀(사용자 인터페이스)로 Vim이라는 문서 편집기 프로그램을 실행했다고 가정하자.
 1. 컴퓨터를 켠 순간 생성된 최초 프로세스는 로그인을 담당하는 프로세스를 자식 프로세스로 생성한 것
 2. 로그인 프로세스는 사용자 인터페이스(bash 셸) 프로세스를 자식 프로세스로 생성한 것
 3. 사용자 인터페이스 프로세스는 Vim 프로세스를 생성한 것이라고 할 수 있다.   

### 프로세스 생성 기법
- 부모 프로세스를 통해 생성된 자식 프로세스들은 복제와 옷 갈아입기를 통해 실행 됨.
- `fork` - 부모 프로세스는 fork를 통해 자신의 복사본을 자식 프로세스로 생성해냄
- `exec` - 만들어진 복사본(자식 프로세스)은 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체함.
- 이 fork와 exec는 시스템콜이다. 
- 부모 프로세스는 fork 시스템 콜을 통해 자신의 복사본을 자식 프로세스로 생성함. (즉, fork는 자기 자신 프로세스의 복사본을 만드는 시스템 콜)
- 자식 프로세스는 부모 프로세스의 복사본 이기에 부모 프로세스의 자원들(메모리의 내의 내용, 열린 파일의 목록 등이 자식 프로세스에 상속됨.)이기에 자원들이 자식 프로세스에 상속됨.

예시:
- 사용자가 bash 셸에 ls라는 명령어를 쳤다고 가정해보자.
1. 셸 프로세스는 fork를 통해 자신과 동일한 프로세스를 생성함.
2. 그로부터 탄생한 자식 프로세스는 exec를 통해 ls 명령어를 실행하기 위한 프로세스로 전환되어 실행됨.
3. 그렇게 셸의 복사본으로 탄생한 자식 프로세스는 ls 명령어를 실행하기 위한 프로세스로 바뀌고, 메모리 공간에는 ls 명령어를 실행하기 위한 내용들이 채워짐.
(즉, 부모가 자식 프로세스를 실행하며 프로세스 계층 구조를 이루는 과정은 fork와 exec가 반복되는 과정임.) 
