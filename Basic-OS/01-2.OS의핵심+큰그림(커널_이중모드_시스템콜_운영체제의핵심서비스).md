# OS의 핵심 및 큰그림(keyword: 커널, 이중모드, 시스템콜, 운영체제의 핵심서비스)

## 커널
1. 아까 장에서 설명했듯, 운영체제의 핵심기능은 자원에 접근하고 조작하는 기능, 프로그램이 올바르게 실행되도록 하는 기능이 핵심이다.
2. 이 핵심적인 역할을 처리하는 부분을 바로 커널(kernel)이라고 한다.
3. 대부분의 운영체제 전공서는 운영체제의 핵심부, 즉 커널에 대해서 설명한다.
4. 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스도 있음. 
    - 사용자 인터페이스(User Interface)
        - 종류: 그래픽 유저 인터페이스(GUI), 커맨드 라인 인터페이스(CLI)

## 이중모드, 시스템 호출(system call)
1. 운영체제는 응용프로그램들이 자원에 접근하려고 할 때, 오직 자신을 통해서만 접근하도록 하여 자원을 보호함.
2. 즉, 응용프로그램이 운영체제 코드를 실행하여 운영체제에게 자원을 관리해달라는 요청을 보내면 운영체제는 대신 자원에 접근하여 요청한 작업을 대신 수행함.
- 예시)
    - Xcode에서 파일매니저로 하드디스크에 접근하는 코드를 빌드한다고 가정해보자.
    - Xcode는 운영체제에게 '나 하드디스크 /User/TravelGenie_V1/ 에 담겨있는 이미지파일 필요함 좀 가져와줘' 라고 요청한다.
    - 운영체제는 커널영역 내의 하드디스크에서 데이터를 가져오는 작업을 대신 수행해준다.
3. 위 예시 작업은 이중모드(dual Mode)를 통해서 구현될 수 있다. (이중모드는 CPU가 명령어를 실행하는 모드를 '사용자모드', '커널모드'로 나누는 것을 말한다)
4. 사용자모드는 운영체제 서비스를 제공받을 수 없는 실행 모드 <=> 커널모드는 운영체제 서비스를 제공받을 수 있는 실행 모드
5. 사용자 모드로 실행되고 있는 프로그램이 자원에 접근하려면 커널모드로 전환되어야함. 이때의 요청을 시스템호출(시스템콜)이라고 말함.
6. 아까 예시에서 빗대어 생각해본다면 사용자모드로 실행중인 앱이 파일매니저를 통해 하드디스크로 접근하려고하면 시스템콜을 발생시켜 커널모드로 진입하여 데이터를 가져오고 난 후, 다시 사용자모드로 돌아오는 방식이다.
7. (의문) 그러면 멀티스레딩을 처리하는 등의 작업 역시 Xcode를 커널모드로 전환하여 운영체제에게 요청하는 방식으로 처리하는 것 아닐까 ? ? ? 궁금하네
8. 일반적으로 응용프로그램은 실행 과정에서 운영체제 서비스들을 매우 빈번하게 사용함. 빈번하게 시스템콜을 발생시키고 사용자모드 - 커널모드를 오가게된다.  


## 운영체제의 핵심 서비스: 프로세스 관리 / 자원 접근 및 할당 / 파일시스템 관리
### 프로세스 관리
1. `프로세스` - 실행 중인 프로그램을 프로세스라고 한다. (윈도우 작업관리자에서 볼 수 있다)
2. 일반적으로 하나의 CPU는 한번에 하나의 프로세스만 실행할 수 있기에, 이 CPU는 프로세스들을 조금씩 번갈아가며 실행함.
    - 2번의 말이 이 말인 것 같다.한 가지 일을 하다가, 잠시 멈추고 또 다른 일을 하고, 또 멈추고 다른 일을 하다 보면 언젠가는 결국 모든 일을 마치게 된다. 이 동작이 엄청 빨라지면 한 번에 여러 가지 일을 하는 것처럼 보이게 되는 것이다.
    - 이 말의 정의를 '멀티태스킹(multi Tasking)'이라고 말하는 것 같다.
    - 프로그래밍 패러다임인 동시성프로그래밍과 작동이 매우 유사하다. 둘의 차이는 멀티태스킹은 운영체제 Level에서의 작업 관리와 관련이 있다는 점, 동시성 프로그래밍은 개발자가 애플리케이션 내에서 여러 작업을 동시에 처리하는 것처럼 보여지도록 이작업 3번과 같이 처리하도록 설계하는 방법임. 
3. 이 때 각 프로세스들은 상태도, 사용하고자 하는 자원도 다양할 것임. (프린터기, 하드디스크, 빨리 실행해야되는 프로세스, 실행불가한 상태인 프로세스 등등)
4. 운영체제는 다양한 프로세스를 일목요연하게 관리하고 실행할 수 있어야 함.
5. 여러프로세스를 동시에 실행하는 환경에선 '프로세스 동기화'가 필수적이고, 프로세스가 꼼짝도 못하고 더 이상 실행되지 못하는 상황인 '교착상태(dead lock)'를 해결해야함.
    - 이거 동시성프로그래밍에서도 dead lock 주의해야하는데!! 진짜 비슷한듯

### 자원 접근 및 할당
- 모든 프로세스는 실행을 위해 자원을 필요로 함 -> 그리고 운영체제는 프로세스들이 사용할 자원에 접근하고 조작함으로써 프로세스에 필요한 자원을 할당해 줌.
- 운영체제가 CPU, 메모리, (보조기억장치) 입출력장치를 어떻게 관리하고 결과적으로 어떤 기능을 제공할까?

#### CPU
1. 일반적으로 메모리에는 여러 프로세스가 적재된다. 하지만, 하나의 CPU는 한번에 하나의 프로세스만 실행 할 수 있다.
2. 해당 프로세스가 얼마나 오래 CPU를 이용하게 할지를 결정하는 행위. 즉, 이를 'CPU 스케줄링'이라고 한다.

#### Memory
1. 메모리에 적재된 프로세스들은 크기도 적재되는 주소도 매우 제각각이다.
2. 운영체제는 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지를 결정한다.

#### 입출력장치
1. 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 있다.
2. 입출력장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 CPU는 하던일을 잠시 백업한 뒤, 커널 영역에 있는 인터럽트 서비스 루틴을 실행함.
3. 운영체제는 인터럽트를 처리하는 프로그램, 즉 인터럽트 서비스 루틴을 제공함으로써 입출력 작업을 수행함.

### 파일 시스템 관리
1. 컴퓨터를 사용할 때, 열고, 생성하고, 삭제하는 행동을 함.
2. 당연해 보이는 이 파일시스템도 운영체제가 지원하는 핵심 서비스임.
